<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Windows 3.1 Web Edition</title>
<style>
/* ==== STILE GENERALE WINDOWS 3.1 ==== */
:root {
  --gray-bg:#c0c0c0; --win-blue:#000080; --win-light:#dfdfdf;
  --win-dark:#808080; --win-border:#404040; --win-white:#ffffff;
  font-family:"MS Sans Serif",Tahoma,system-ui;
}
body {
  background:var(--gray-bg);
  margin:0; overflow:hidden;
  height:100vh; width:100vw;
  user-select:none;
}
#desktop {
  position:relative;
  width:100%; height:100%;
  background:#008080 url('https://upload.wikimedia.org/wikipedia/commons/d/dc/Windows_3.1_wallpaper.svg') center/cover no-repeat;
}
.window {
  position:absolute;
  background:var(--gray-bg);
  border:2px solid var(--win-dark);
  border-top-color:var(--win-white);
  border-left-color:var(--win-white);
  box-shadow:2px 2px 0 var(--win-border);
  min-width:200px;
}
.titlebar {
  background:var(--win-blue);
  color:white;
  padding:2px 4px;
  font-weight:bold;
  display:flex; justify-content:space-between; align-items:center;
  cursor:move;
}
.titlebar button {
  background:var(--gray-bg);
  border:2px outset var(--win-light);
  font-size:12px;
  line-height:12px;
  width:18px; height:18px;
  padding:0; margin:0;
}
.content {padding:4px; background:var(--gray-bg);}
.icon {
  display:inline-block;
  width:64px; text-align:center; color:white;
  font-size:12px; margin:12px;
}
.icon img {width:32px; height:32px; display:block; margin:0 auto 4px;}
.icon:active {filter:brightness(1.2);}
#taskbar {
  position:absolute; bottom:0; left:0; right:0;
  height:22px;
  background:var(--gray-bg);
  border-top:2px solid var(--win-white);
  border-bottom:2px solid var(--win-dark);
  display:flex; align-items:center; padding:0 4px; gap:6px;
  font-size:12px;
}
.taskbtn {
  border:2px outset var(--win-light);
  background:var(--gray-bg);
  padding:2px 6px;
}
@media (max-width:800px){
  .icon{width:52px;font-size:10px;margin:8px;}
  .icon img{width:24px;height:24px;}
}
</style>
</head>
<body>
<div id="desktop">
  <!-- Icone principali -->
  <div class="icon" data-app="main">
    <img src="https://win98icons.alexmeub.com/icons/png/folder_programs-2.png">
    <span>Main</span>
  </div>
  <div class="icon" data-app="accessories">
    <img src="https://win98icons.alexmeub.com/icons/png/folder_open-1.png">
    <span>Accessori</span>
  </div>
  <div class="icon" data-app="games">
    <img src="https://win98icons.alexmeub.com/icons/png/folder_games-1.png">
    <span>Giochi</span>
  </div>
  <div class="icon" data-app="netscape">
    <img src="https://win98icons.alexmeub.com/icons/png/world_network_directories-4.png">
    <span>Netscape</span>
  </div>

  <!-- Barra inferiore -->
  <div id="taskbar"><b>Program Manager</b></div>
</div>

<script>
/* ==== SISTEMA FINESTRE ==== */
let z=10;

function makeWindow(title,content,id){
  const w=document.createElement('div');
  w.className='window'; w.id=id;
  w.style.left='60px'; w.style.top='60px';
  w.style.zIndex=z++;
  w.innerHTML=`<div class="titlebar">
      <span>${title}</span>
      <button onclick="this.closest('.window').remove()">×</button>
    </div>
    <div class="content">${content}</div>`;
  document.getElementById('desktop').appendChild(w);
  dragWindow(w);
}

function dragWindow(el){
  const bar=el.querySelector('.titlebar');
  let offX=0,offY=0,drag=false;
  bar.addEventListener('pointerdown',e=>{
    drag=true; offX=e.clientX-el.offsetLeft; offY=e.clientY-el.offsetTop;
    el.style.zIndex=++z;
  });
  window.addEventListener('pointermove',e=>{
    if(!drag)return;
    el.style.left=(e.clientX-offX)+'px';
    el.style.top=(e.clientY-offY)+'px';
  });
  window.addEventListener('pointerup',()=>drag=false);
}

/* ==== APERTURA DELLE ICONE ==== */
const apps={
  main:`<div><button onclick="openApp('fileman')">File Manager</button>
        <button onclick="openApp('control')">Control Panel</button>
        <button onclick="openApp('dos')">MS-DOS Prompt</button></div>`,
  accessories:`<div><button onclick="openApp('paint')">Paintbrush</button>
        <button onclick="openApp('calc')">Calculator</button>
        <button onclick="openApp('clock')">Clock</button>
        <button onclick="openApp('notepad')">Notepad</button>
        <button onclick="openApp('charmap')">Character Map</button>
        <button onclick="openApp('write')">Write</button></div>`,
  games:`<div><button onclick="openApp('sol')">Solitaire</button>
        <button onclick="openApp('mine')">Minesweeper</button>
        <button onclick="openApp('ski')">SkiFree</button></div>`,
  netscape:`<iframe srcdoc="<h3 style='font-family:sans-serif'>Netscape Navigator</h3>" width="300" height="200"></iframe>`
};

document.querySelectorAll('.icon').forEach(ic=>{
  ic.addEventListener('dblclick',()=>{
    const id=ic.dataset.app;
    if(document.getElementById('win_'+id))return;
    makeWindow(ic.querySelector('span').textContent,apps[id],'win_'+id);
  });
});

/* Placeholder per app future */
function openApp(name){
  if(document.getElementById('app_'+name))return;
  makeWindow(name.charAt(0).toUpperCase()+name.slice(1),
             `<p>${name} in caricamento...</p>`,'app_'+name);
}
</script>
</body>
</html>
<style>
/* ==== PROGRAM MANAGER (GRUPPI & ICONE) ==== */
.prog-group {
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(84px,1fr));
  gap:8px; padding:6px;
  background:var(--gray-bg);
}
.prog-icon {
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  width:84px; height:84px; padding:6px;
  border:2px solid transparent;
  text-align:center; font-size:11px; color:black; line-height:1.2;
}
.prog-icon img { width:28px; height:28px; image-rendering: pixelated; margin-bottom:6px; }
.prog-icon.selected {
  border-top-color:var(--win-white);
  border-left-color:var(--win-white);
  border-right-color:var(--win-dark);
  border-bottom-color:var(--win-dark);
  background:var(--win-light);
}
.prog-icon:active { filter:brightness(1.1); }

.win-buttons {
  display:flex; gap:6px; flex-wrap:wrap; padding:6px;
}
.win-btn {
  font-size:12px;
  padding:3px 8px;
  border:2px outset var(--win-light);
  background:var(--gray-bg);
}
.win-btn:active { border:2px inset var(--win-light); }

.separator {
  height:2px; margin:6px 0;
  border-top:2px solid var(--win-white);
  border-bottom:2px solid var(--win-dark);
}
</style>

<script>
/* ==== UTILITY: DOPPIO TAP PER MOBILE ==== */
function makeDoubleTap(el, onDouble){
  let last=0, timer=null;
  el.addEventListener('click', e=>{
    const now=Date.now();
    if(now-last<350){ // doppio-tap veloce
      clearTimeout(timer); last=0; onDouble(e);
    } else {
      last=now;
      // selezione visiva al primo tap
      document.querySelectorAll('.prog-icon').forEach(i=>i.classList.remove('selected'));
      if(el.classList.contains('prog-icon')) el.classList.add('selected');
      // timeout per reset finestra di doppio tap
      timer=setTimeout(()=>{ last=0; }, 380);
    }
  });
  // supporto anche al doppio click desktop
  el.addEventListener('dblclick', e=>{ e.preventDefault(); onDouble(e); });
}

/* ==== MIGLIORIA: PORTA IN PRIMO PIANO AL TOCCO ==== */
document.addEventListener('pointerdown', e=>{
  const w=e.target.closest('.window');
  if(w){ w.style.zIndex=++z; }
});

/* ==== DATI DELLE ICONE CON IMMAGINI STILE 3.1/95 ==== */
const ICONS = {
  folder:'https://win98icons.alexmeub.com/icons/png/directory_open_file_mydocs-3.png',
  fileman:'https://win98icons.alexmeub.com/icons/png/directory_open_file_mydocs-3.png',
  control:'https://win98icons.alexmeub.com/icons/png/settings_gear-2.png',
  dos:'https://win98icons.alexmeub.com/icons/png/ms_dos-0.png',
  paint:'https://win98icons.alexmeub.com/icons/png/paint_file-1.png',
  calc:'https://win98icons.alexmeub.com/icons/png/calculator-2.png',
  clock:'https://win98icons.alexmeub.com/icons/png/clock-0.png',
  notepad:'https://win98icons.alexmeub.com/icons/png/notepad-2.png',
  charmap:'https://win98icons.alexmeub.com/icons/png/character_map-0.png',
  write:'https://win98icons.alexmeub.com/icons/png/write_y-0.png',
  sol:'https://win98icons.alexmeub.com/icons/png/solitaire-0.png',
  mine:'https://win98icons.alexmeub.com/icons/png/minesweeper-0.png',
  ski:'https://win98icons.alexmeub.com/icons/png/joystick-2.png',
  netscape:'https://win98icons.alexmeub.com/icons/png/world_network_directories-4.png'
};

/* ==== GENERATORE DI FINESTRE-GRUPPO (Program Manager) ==== */
function groupWindow(title, id, items){
  if(document.getElementById('win_'+id)) { bringToFront('win_'+id); return; }

  const grid = document.createElement('div');
  grid.className='prog-group';
  grid.setAttribute('role','list');

  items.forEach(app=>{
    const ic = document.createElement('div');
    ic.className='prog-icon';
    ic.setAttribute('role','listitem');
    ic.setAttribute('tabindex','0');
    ic.dataset.app = app.app;
    ic.innerHTML = `<img alt="" src="${ICONS[app.icon]||ICONS.folder}"><div>${app.label}</div>`;

    makeDoubleTap(ic, ()=>{
      openApp(app.app);
    });

    ic.addEventListener('keydown', ev=>{
      if(ev.key==='Enter'){ openApp(app.app); }
    });

    grid.appendChild(ic);
  });

  makeWindow(title, grid.outerHTML, 'win_'+id);
}

/* ==== PORTA UNA FINESTRA IN PRIMO PIANO SE ESISTE ==== */
function bringToFront(id){
  const w=document.getElementById(id);
  if(!w) return;
  w.style.zIndex=++z;
}

/* ==== SOSTITUISCI IL CONTENUTO DELLE ICONE DEL DESKTOP (Blocco 1) ==== */
const DESKTOP_ICONS_MAP = {
  main: {
    title: 'Main',
    items: [
      {label:'File Manager', app:'fileman', icon:'fileman'},
      {label:'Control Panel', app:'control', icon:'control'},
      {label:'MS-DOS Prompt', app:'dos', icon:'dos'}
    ]
  },
  accessories: {
    title: 'Accessori',
    items: [
      {label:'Paintbrush', app:'paint', icon:'paint'},
      {label:'Calculator', app:'calc', icon:'calc'},
      {label:'Clock', app:'clock', icon:'clock'},
      {label:'Notepad', app:'notepad', icon:'notepad'},
      {label:'Character Map', app:'charmap', icon:'charmap'},
      {label:'Write', app:'write', icon:'write'}
    ]
  },
  games: {
    title: 'Giochi',
    items: [
      {label:'Solitaire', app:'sol', icon:'sol'},
      {label:'Minesweeper', app:'mine', icon:'mine'},
      {label:'SkiFree', app:'ski', icon:'ski'}
    ]
  },
  netscape: {
    title: 'Netscape Navigator',
    items: [
      // lasceremo l’icona singola a scopo “about”, l’app vera sarà finestra dedicata
      {label:'Apri Netscape', app:'netscape_app', icon:'netscape'}
    ]
  }
};

/* ==== WIRING: APERTURA ICONE DESKTOP COME FINESTRE-GRUPPO ==== */
document.querySelectorAll('.icon').forEach(ic=>{
  ic.replaceWith(ic.cloneNode(true)); // pulisci vecchi listeners dal Blocco 1
});
document.querySelectorAll('.icon').forEach(ic=>{
  ic.addEventListener('dblclick', ()=>{
    const id=ic.dataset.app;
    const group = DESKTOP_ICONS_MAP[id];
    if(!group){
      // fallback: apri direttamente (Netscape)
      openApp(id);
      return;
    }
    groupWindow(group.title, id, group.items);
  });
  // doppio tap mobile
  makeDoubleTap(ic, ()=>{
    const id=ic.dataset.app;
    const group = DESKTOP_ICONS_MAP[id];
    if(!group){ openApp(id); return; }
    groupWindow(group.title, id, group.items);
  });
});

/* ==== MIGLIORA openApp PER APPLICAZIONI NON ANCORA IMPLEMENTATE ==== */
const APP_TITLES = {
  fileman:'File Manager',
  control:'Control Panel',
  dos:'MS-DOS Prompt',
  paint:'Paintbrush',
  calc:'Calculator',
  clock:'Clock',
  notepad:'Notepad',
  charmap:'Character Map',
  write:'Write',
  sol:'Solitaire',
  mine:'Minesweeper',
  ski:'SkiFree',
  netscape:'Netscape Navigator',
  netscape_app:'Netscape Navigator'
};

const APP_LOADING = `
  <div class="win-buttons">
    <button class="win-btn" onclick="this.closest('.window').remove()">Close</button>
    <button class="win-btn" onclick="alert('In arrivo nel Blocco successivo!')">Help</button>
  </div>
  <div class="separator"></div>
  <div style="padding:8px;font-size:12px">
    <b>Caricamento componente...</b><br>
    Questa applicazione verrà attivata nei prossimi blocchi (funzionalità completa).
  </div>
`;

// Sovrascrive la placeholder del Blocco 1 per dare titoli corretti
window.openApp = function(name){
  const winId = 'app_'+name;
  if(document.getElementById(winId)){ bringToFront(winId); return; }
  const title = APP_TITLES[name] || (name.charAt(0).toUpperCase()+name.slice(1));
  makeWindow(title, APP_LOADING, winId);
};

</script>
